<%
  const colors = ["bg-red-400", "bg-orange-400", "bg-yellow-400", "bg-green-400", "bg-blue-400"];
  const values = [1, 2, 3, 4, 5];
  const inputName = typeof ratingName !== "undefined" ? ratingName : "rating";
%>

<div class="flex w-[420px] rounded-full overflow-hidden" data-rating-bar="<%= inputName %>">
  <% values.forEach((v, i) => { %>
    <label class="flex-1 px-[1px] cursor-pointer">
      <input type="radio" name="<%= inputName %>" value="<%= v %>" class="peer hidden" />
      <div class="h-12 flex items-center justify-center bg-gray-300 transition 
                  <%= i === 0 ? 'rounded-l-full' : '' %> 
                  <%= i === values.length-1 ? 'rounded-r-full' : '' %>"
           data-section="<%= v %>"
           data-color="<%= colors[i] %>">
        <%= v %>
      </div>
    </label>
  <% }) %>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const bar = document.querySelector('[data-rating-bar="<%= inputName %>"]');
  if (!bar) return;

  const inputs = bar.querySelectorAll("input[type=radio]");
  const sections = bar.querySelectorAll("[data-section]");

  inputs.forEach(input => {
    input.addEventListener("change", () => {
      const val = parseInt(input.value);

      sections.forEach(section => {
        const v = parseInt(section.dataset.section);
        const color = section.dataset.color;

        // reset
        section.classList.remove("bg-red-400", "bg-orange-400", "bg-yellow-400", "bg-green-400", "bg-blue-400");
        section.classList.add("bg-gray-300");

        // fill up to selection
        if (v <= val) {
          section.classList.remove("bg-gray-300");
          section.classList.add(color);
        }
      });
    });
  });
});
</script>
